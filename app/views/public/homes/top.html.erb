<div class="main-visual">
  <%= image_tag ("top-mv01.jpg"), class: "img-fluid" %>
</div>
<div class="container-fluid">

  <div class="row mx-5 px-5 my-4">
    <div class="col-xl-3 px-xl-5">
      <h5 class="border-bottom font-weight-bold">
        <i class="fa-solid fa-crown"></i> 楽天売れ筋<span class="small font-weight-bold">ランキング</span>
      </h5>
      <ul class="list-unstyled medium">
        <li>
          <%= link_to "男性ランキング", items_ranking_path(sex: 0, title: "男性" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "女性ランキング", items_ranking_path(sex: 1, title: "女性" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "10代ランキング", items_ranking_path(age: 10, title: "10代" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "20代ランキング", items_ranking_path(age: 20, title: "20代" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "30代ランキング", items_ranking_path(age: 30, title: "30代" ), class: "text-dark" %>
          </li>
        <li>
          <%= link_to "40代ランキング", items_ranking_path(age: 40, title: "40代" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "50代ランキング", items_ranking_path(age: 50, title: "50代" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "レディースファッション", items_ranking_path(genre: 100371, title: "レディースファッション" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "メンズファッション", items_ranking_path(genre: 551177, title: "メンズファッション" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "ジュエリー・アクセサリー", items_ranking_path(genre: 216129, title: "ジュエリー・アクセサリー" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "バッグ・小物・ブランド雑貨", items_ranking_path(genre: 216131, title: "バッグ・小物・ブランド雑貨" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "靴", items_ranking_path(genre: 558885, title: "靴" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "腕時計", items_ranking_path(genre: 558929, title: "腕時計" ), class: "text-dark" %>
        </li>
        <li>
            <%= link_to "食品", items_ranking_path(genre: 100227, title: "食品" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "スイーツ・お菓子", items_ranking_path(genre: 551167, title: "スイーツ・お菓子" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "ビール・洋酒", items_ranking_path(genre: 510915, title: "ビール・洋酒" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "日本酒・焼酎", items_ranking_path(genre: 510901, title: "日本酒・焼酎" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "美容・コスメ・香水", items_ranking_path(genre: 100939, title: "美容・コスメ・香水" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "花・ガーデン・DIY", items_ranking_path(genre: 100005, title: "花・ガーデン・DIY" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "キッズ・ベビー・マタニティ", items_ranking_path(genre: 100533, title: "キッズ・ベビー・マタニティ" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "カタログギフト・チケット", items_ranking_path(genre: 101381, title: "カタログギフト・チケット" ), class: "text-dark" %>
        </li>
      </ul>
      <h5 class="border-bottom font-weight-bold pt-4">
        <i class="fa-solid fa-crown"></i>GiveLike<span class="small font-weight-bold">レビューランキング</span>
      </h5>
      <ul class="list-unstyled medium">
        <li>
          <%= search_form_for @q, url: reviews_ranking_path do |f| %>
            <%= f.hidden_field :end_user_gender_eq, :value => "0" %>
            <%= f.submit '男性レビューランキング', class: "btn btn-link text-dark medium p-0" %>
          <% end %>
        </li>
        <li>
          <%= search_form_for @q, url: reviews_ranking_path do |f| %>
            <%= f.hidden_field :end_user_gender_eq, :value => "1" %>
            <%= f.submit '女性レビューランキング', class: "btn btn-link text-dark medium p-0" %>
          <% end %>
        </li>
        <li>
          <%= search_form_for @q, url: reviews_ranking_path do |f| %>
            <%= f.hidden_field :end_user_birth_day_to_age_gteq, :value => "10" %>
            <%= f.hidden_field :end_user_birth_day_to_age_lteq, :value => "19" %>
            <%= f.submit '10代レビューランキング', class: "btn btn-link text-dark medium p-0" %>
          <% end %>
        </li>
        <li>
          <%= search_form_for @q, url: reviews_ranking_path do |f| %>
            <%= f.hidden_field :end_user_birth_day_to_age_gteq, :value => "20" %>
            <%= f.hidden_field :end_user_birth_day_to_age_lteq, :value => "29" %>
            <%= f.submit '20代レビューランキング', class: "btn btn-link text-dark medium p-0" %>
          <% end %>
        </li>
        <li>
          <%= search_form_for @q, url: reviews_ranking_path do |f| %>
            <%= f.hidden_field :end_user_birth_day_to_age_gteq, :value => "30" %>
            <%= f.hidden_field :end_user_birth_day_to_age_lteq, :value => "39" %>
            <%= f.submit '30代レビューランキング', class: "btn btn-link text-dark medium p-0" %>
          <% end %>
        </li>
        <li>
          <%= search_form_for @q, url: reviews_ranking_path do |f| %>
            <%= f.hidden_field :end_user_birth_day_to_age_gteq, :value => "40" %>
            <%= f.hidden_field :end_user_birth_day_to_age_lteq, :value => "49" %>
            <%= f.submit '40代レビューランキング', class: "btn btn-link text-dark medium p-0" %>
          <% end %>
        </li>
        <li>
          <%= search_form_for @q, url: reviews_ranking_path do |f| %>
            <%= f.hidden_field :end_user_birth_day_to_age_gteq, :value => "50" %>
            <%= f.hidden_field :end_user_birth_day_to_age_lteq, :value => "59" %>
            <%= f.submit '50代レビューランキング', class: "btn btn-link text-dark medium p-0" %>
          <% end %>
        </li>
      </ul>

      <p class="font-weight-bold pt-3 mb-0"><i class="fa-solid fa-magnifying-glass"></i> 検索</p>
      <%= search_form_for @q, url: reviews_ranking_path do |f| %>
        <div class="form-group">
          <%= f.search_field :name_cont, placeholder: '商品名でランキングを絞り込む', class:'form-control medium' %>
        </div>
        <div class="form-group medium">
          <div class="form-check form-check-inline">
            <%= f.check_box :end_user_gender_eq_any, { multiple: true, include_hidden: false, class: 'form-check-input', id: 'gender-check1' }, 0, '' %>
            <%= f.label EndUser.genders_i18n[:male], class:'form-check-label', for: 'gender-check1' %>
          </div>
          <div class="form-check form-check-inline">
            <%= f.check_box :end_user_gender_eq_any, { multiple: true, include_hidden: false, class: 'form-check-input', id: 'gender-check2' }, 1, '' %>
            <%= f.label EndUser.genders_i18n[:female], class:'form-check-label', for: 'gender-check2' %>
          </div>
          <div class="form-check form-check-inline">
            <%= f.check_box :end_user_gender_eq_any, { multiple: true, include_hidden: false, class: 'form-check-input', id: 'gender-check3' }, 2, '' %>
            <%= f.label EndUser.genders_i18n[:not_selected], class:'form-check-label', for: 'gender-check3' %>
          </div>
        </div>
        <div class="form-group row no-gutters medium">
          <div class="col-3">
            <%= f.select :end_user_birth_day_to_age_gteq, *[10..100] , { include_blank: "" }, { class: "form-control small" } %>
          </div>
          <label for="staticEmail" class="col-3 col-form-label pl-1">歳以上</label>
            <div class="col-3">
            <%= f.select :end_user_birth_day_to_age_lteq, *[10..100] , { include_blank: "" }, { class: "form-control small" } %>
          </div>
          <label for="staticEmail" class="col-3 col-form-label pl-1">歳以下</label>
        </div>
      <%= f.submit '検索する', class: "btn btn-secondary btn-sm btn-block" %>
    <% end %>
  </div>




  <div class="col-xl-9">

<h2 style="background-color:#cccccc">貰って嬉しかった物アンケート <%= link_to "アンケートに参加する(全５問)", new_response_path, class: "btn btn-light bg-gold px-5" %></h2>

<div style="position:relative; width:950px; height:250px;">
    <canvas id="responsesChart"></canvas>
</div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const ctx = document.getElementById('responsesChart');

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels:[
          <% @responses.each do |response| %>
              "<%= response.present_genre_i18n %>",
            <% end %>
            ],
        datasets: [{
          data: [
            <% @responses.each do |response| %>
              <%= Response.where(present_genre: response.present_genre ).count.to_i %>,
            <% end %>
            ],
            barPercentgifted_event: 0.7
        }]
      },
      options: {
          indexAxis: 'y',
          maintainAspectRatio: false,
          plugins: {
            legend: false
          },
          scales: {
                x: {
                    grid: {
                        display: false,
                    },
                    ticks: {
                        display: false
                    },
                    border: {
                        display: false
                    }
                }
            }
      }
    });
  </script>

  <h4>年齢別集計結果</h4>
  <% @teens_responses.each do |teens_response| %>
    [<%= teens_response.age_i18n %>]<%= teens_response.present_genre_i18n %>
    <%=  Response.where(present_genre: teens_response.present_genre, age: teens_response.age).count %><br>
  <% end %>
  <% @twenties_responses.each do |twenties_response| %>
    [<%= twenties_response.age_i18n %>]<%= twenties_response.present_genre_i18n %>
    <%=  Response.where(present_genre: twenties_response.present_genre, age: twenties_response.age).count %><br>
  <% end %>
  <% @thirties_responses.each do |thirties_response| %>
    [<%= thirties_response.age_i18n %>]<%= thirties_response.present_genre_i18n %>
    <%=  Response.where(present_genre: thirties_response.present_genre, age: thirties_response.age).count %><br>
  <% end %>
  <% @forties_responses.each do |forties_response| %>
    [<%= forties_response.age_i18n %>]<%= forties_response.present_genre_i18n %>
    <%=  Response.where(present_genre: forties_response.present_genre, age: forties_response.age).count %><br>
  <% end %>
  <% @fifties_responses.each do |fifties_response| %>
    [<%= fifties_response.age_i18n %>]<%= fifties_response.present_genre_i18n %>
    <%=  Response.where(present_genre: fifties_response.present_genre, age: fifties_response.age).count %><br>
  <% end %>
  <% @sixties_responses.each do |sixties_response| %>
    [<%= sixties_response.age_i18n %>]<%= sixties_response.present_genre_i18n %>
    <%=  Response.where(present_genre: sixties_response.present_genre, age: sixties_response.age).count %><br>
  <% end %>
  <% @seventies_responses.each do |seventies_response| %>
    [<%= seventies_response.age_i18n %>]<%= seventies_response.present_genre_i18n %>
    <%=  Response.where(present_genre: seventies_response.present_genre, age: seventies_response.age).count %><br>
  <% end %>

  <h4>男女別集計結果</h4>
  <% @male_responses.each_with_index do |male_response, i| %>
    <%= i + 1 %>位::
    <%= male_response.present_genre_i18n %>
    （<%=  Response.where(present_genre: male_response.present_genre, gender: male_response.gender).count %>）<br>
  <% end %>
  <br>
  <% @female_responses.each_with_index do |female_response, i| %>
    <%= i + 1 %>位::
    <%= female_response.present_genre_i18n %>
    （<%=  Response.where(present_genre: female_response.present_genre, gender: female_response.gender).count %>）<br>
  <% end %>

  <hr>
  <%= link_to "アンケート結果をもっと見る", responses_path, class: "btn btn-light bg-gold px-5" %>
  <hr>

  <h2 style="background-color:#cccccc">楽天プレゼントランキング <%= link_to "もっと見る", items_path, class: "btn btn-light bg-gold px-5" %></h2>
  <% @items.each_with_index do |item, i| %>
    <%= i + 1 %><br>
    <%= link_to item_path(item.code, name: item.name, code: item.code, genre: item.genre.id, price: item.price, image: item.medium_image_urls[0], url: item.url) do %>
      <%= image_tag (item['smallImageUrls'][0]) %>
    <% end %>
    <%= item.name %><br>
    <%= number_with_delimiter(item.price) %>円
    <hr>
  <% end %>

  <h2 style="background-color:#cccccc">GiveLikeレビューランキング <%= link_to "もっと見る", reviews_ranking_path, class: "btn btn-light bg-gold px-5" %></h2>
  <% @reviews.each_with_index do |review, i| %>
      <%= i + 1 %><br>
      <%= image_tag (review.image) %>
      <%= review.name %><br>
      評価：<%=  (Review.where(code: review.code).sum  {|review| review.evaluation} / Review.where(code: review.code).length).round(1) %><br>
      <%= number_with_delimiter(review.price) %>円
      <div id="star-rate<%= review.id %>"></div>
        <script>
        var elem = document.getElementById('star-rate<%= review.id %>');
        var opt = {
        starOn: "<%= asset_path('star-on.png') %>",
        starOff: "<%= asset_path('star-off.png') %>",
        starHalf: "<%= asset_path('star-half.png') %>",
        half: true,
        readOnly: true,
        score: <%= (Review.where(code: review.code).sum  {|review| review.evaluation} / Review.where(code: review.code).length).round(1) %>,
          };
          raty(elem,opt);
        </script>
      <hr>
    <% end %>