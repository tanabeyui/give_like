<div class="main-visual">
  <%= image_tag ("top-mv.png"), class: "img-fluid" %>
</div>
<div class="container-fluid">

  <div class="row mx-5 px-5 my-4">
    <div class="col-xl-3 px-xl-5 mt-2">
      <h5 class="border-bottom border-secondary font-weight-bold">
        <i class="fa-sharp fa-solid fa-crown"></i> 楽天売れ筋<span class="small font-weight-bold">ランキング</span>
      </h5>
      <ul class="list-unstyled medium">
        <li>
          <%= link_to "男性ランキング", items_ranking_path(sex: 0, title: "男性" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "女性ランキング", items_ranking_path(sex: 1, title: "女性" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "10代ランキング", items_ranking_path(age: 10, title: "10代" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "20代ランキング", items_ranking_path(age: 20, title: "20代" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "30代ランキング", items_ranking_path(age: 30, title: "30代" ), class: "text-dark" %>
          </li>
        <li>
          <%= link_to "40代ランキング", items_ranking_path(age: 40, title: "40代" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "50代ランキング", items_ranking_path(age: 50, title: "50代" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "レディースファッション", items_ranking_path(genre: 100371, title: "レディースファッション" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "メンズファッション", items_ranking_path(genre: 551177, title: "メンズファッション" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "ジュエリー・アクセサリー", items_ranking_path(genre: 216129, title: "ジュエリー・アクセサリー" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "バッグ・小物・ブランド雑貨", items_ranking_path(genre: 216131, title: "バッグ・小物・ブランド雑貨" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "靴", items_ranking_path(genre: 558885, title: "靴" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "腕時計", items_ranking_path(genre: 558929, title: "腕時計" ), class: "text-dark" %>
        </li>
        <li>
            <%= link_to "食品", items_ranking_path(genre: 100227, title: "食品" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "スイーツ・お菓子", items_ranking_path(genre: 551167, title: "スイーツ・お菓子" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "ビール・洋酒", items_ranking_path(genre: 510915, title: "ビール・洋酒" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "日本酒・焼酎", items_ranking_path(genre: 510901, title: "日本酒・焼酎" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "美容・コスメ・香水", items_ranking_path(genre: 100939, title: "美容・コスメ・香水" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "花・ガーデン・DIY", items_ranking_path(genre: 100005, title: "花・ガーデン・DIY" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "キッズ・ベビー・マタニティ", items_ranking_path(genre: 100533, title: "キッズ・ベビー・マタニティ" ), class: "text-dark" %>
        </li>
        <li>
          <%= link_to "カタログギフト・チケット", items_ranking_path(genre: 101381, title: "カタログギフト・チケット" ), class: "text-dark" %>
        </li>
      </ul>
      <h5 class="border-bottom border-secondary font-weight-bold pt-4">
        <i class="fa-sharp fa-solid fa-crown"></i>GiveLike<span class="small font-weight-bold">レビューランキング</span>
      </h5>
      <ul class="list-unstyled medium">
        <li>
          <%= search_form_for @q, url: reviews_ranking_path do |f| %>
            <%= f.hidden_field :end_user_gender_eq, :value => "0" %>
            <%= f.submit '男性レビューランキング', class: "btn btn-link text-dark medium p-0" %>
          <% end %>
        </li>
        <li>
          <%= search_form_for @q, url: reviews_ranking_path do |f| %>
            <%= f.hidden_field :end_user_gender_eq, :value => "1" %>
            <%= f.submit '女性レビューランキング', class: "btn btn-link text-dark medium p-0" %>
          <% end %>
        </li>
        <li>
          <%= search_form_for @q, url: reviews_ranking_path do |f| %>
            <%= f.hidden_field :end_user_birth_day_to_age_gteq, :value => "10" %>
            <%= f.hidden_field :end_user_birth_day_to_age_lteq, :value => "19" %>
            <%= f.submit '10代レビューランキング', class: "btn btn-link text-dark medium p-0" %>
          <% end %>
        </li>
        <li>
          <%= search_form_for @q, url: reviews_ranking_path do |f| %>
            <%= f.hidden_field :end_user_birth_day_to_age_gteq, :value => "20" %>
            <%= f.hidden_field :end_user_birth_day_to_age_lteq, :value => "29" %>
            <%= f.submit '20代レビューランキング', class: "btn btn-link text-dark medium p-0" %>
          <% end %>
        </li>
        <li>
          <%= search_form_for @q, url: reviews_ranking_path do |f| %>
            <%= f.hidden_field :end_user_birth_day_to_age_gteq, :value => "30" %>
            <%= f.hidden_field :end_user_birth_day_to_age_lteq, :value => "39" %>
            <%= f.submit '30代レビューランキング', class: "btn btn-link text-dark medium p-0" %>
          <% end %>
        </li>
        <li>
          <%= search_form_for @q, url: reviews_ranking_path do |f| %>
            <%= f.hidden_field :end_user_birth_day_to_age_gteq, :value => "40" %>
            <%= f.hidden_field :end_user_birth_day_to_age_lteq, :value => "49" %>
            <%= f.submit '40代レビューランキング', class: "btn btn-link text-dark medium p-0" %>
          <% end %>
        </li>
        <li>
          <%= search_form_for @q, url: reviews_ranking_path do |f| %>
            <%= f.hidden_field :end_user_birth_day_to_age_gteq, :value => "50" %>
            <%= f.hidden_field :end_user_birth_day_to_age_lteq, :value => "59" %>
            <%= f.submit '50代レビューランキング', class: "btn btn-link text-dark medium p-0" %>
          <% end %>
        </li>
      </ul>

      <p class="font-weight-bold pt-3 mb-0"><i class="fa-solid fa-magnifying-glass"></i> 検索</p>
      <%= search_form_for @q, url: reviews_ranking_path do |f| %>
        <div class="form-group">
          <%= f.search_field :name_cont, placeholder: '商品名でランキングを絞り込む', class:'form-control medium' %>
        </div>
        <div class="form-group medium">
          <div class="form-check form-check-inline">
            <%= f.check_box :end_user_gender_eq_any, { multiple: true, include_hidden: false, class: 'form-check-input', id: 'gender-check1' }, 0, '' %>
            <%= f.label EndUser.genders_i18n[:male], class:'form-check-label', for: 'gender-check1' %>
          </div>
          <div class="form-check form-check-inline">
            <%= f.check_box :end_user_gender_eq_any, { multiple: true, include_hidden: false, class: 'form-check-input', id: 'gender-check2' }, 1, '' %>
            <%= f.label EndUser.genders_i18n[:female], class:'form-check-label', for: 'gender-check2' %>
          </div>
          <div class="form-check form-check-inline">
            <%= f.check_box :end_user_gender_eq_any, { multiple: true, include_hidden: false, class: 'form-check-input', id: 'gender-check3' }, 2, '' %>
            <%= f.label EndUser.genders_i18n[:not_selected], class:'form-check-label', for: 'gender-check3' %>
          </div>
        </div>
        <div class="form-group row no-gutters medium">
          <div class="col-3">
            <%= f.select :end_user_birth_day_to_age_gteq, *[10..100] , { include_blank: "" }, { class: "form-control small" } %>
          </div>
          <label for="staticEmail" class="col-3 col-form-label pl-1">歳以上</label>
            <div class="col-3">
            <%= f.select :end_user_birth_day_to_age_lteq, *[10..100] , { include_blank: "" }, { class: "form-control small" } %>
          </div>
          <label for="staticEmail" class="col-3 col-form-label pl-1">歳以下</label>
        </div>
      <%= f.submit '検索する', class: "btn btn-secondary btn-sm btn-block" %>
    <% end %>
  </div>


  <div class="col-xl-9">
    <h5 class="headline bg-beige font-weight-bold py-3">
      貰って嬉しかったものアンケート
      <%= link_to " 投票する（全５問）", new_response_path, class: "bg-danger text-white medium mx-3 py-1 pl-2 pr-1" %>
    </h5>

    <div class="mx-auto" style="position:relative; width:90%; height:250px;">
        <canvas id="responsesChart"></canvas>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const ctx = document.getElementById('responsesChart');

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels:[
              <% @responses.each do |response| %>
                "<%= response.present_genre_i18n %>",
              <% end %>
              ],
          datasets: [{
            data: [
              <% @responses.each do |response| %>
                <%= Response.where(present_genre: response.present_genre ).count.to_i %>,
              <% end %>
              ],
              barPercentgifted_event: 0.7,
              backgroundColor: "#17a2b8"
          }]
        },
        options: {
            indexAxis: 'y',
            maintainAspectRatio: false,
            plugins: {
              legend: false
            },
            scales: {
                  x: {
                      grid: {
                          display: false,
                      },
                      ticks: {
                          display: false
                      },
                      border: {
                          display: false
                      }
                  }
              }
        }
      });
    </script>

    <div class="row no-gutters my-3">
      <div class="col-sm-6 bg-gray p-4">
        <h6 class="subheading font-weight-bold">年齢別No.1</h6>

        <dl class="row no-gutters medium p-2">
          <% @ages.each do |age| %>
            <% by_age_response = Response.where(age: age).group(:present_genre).order('count(id) desc').first %>
            <dd class="col-2 font-weight-bold medium mb-1"><%= by_age_response.age_i18n %></dd>
            <dd class="col-10 medium mb-1">
              <span class="text-gold"><i class="fa-sharp fa-solid fa-crown"></i></span>
              <%= by_age_response.present_genre_i18n %>
            </dd>
          <% end %>
        </dl>
      </div>

      <div class="col-sm-6 bg-gray p-4">
        <h6 class="subheading font-weight-bold">男女別TOP3</h6>

        <div class="row no-gutters p-2">
          <div class="col-1">
            <p class="font-weight-bold">男性</p>
          </div>
          <div class="col-1">
            <ul class="list-unstyled medium m-0">
              <li class="text-gold text-right px-1"><i class="fa-sharp fa-solid fa-crown"></i></span></li>
              <li class="text-silver text-right px-1"><i class="fa-sharp fa-solid fa-crown"></i></span></li>
              <li class="text-bronze text-right px-1"><i class="fa-sharp fa-solid fa-crown"></i></span></li>
            </ul>
          </div>
          <div class="col-10">
            <ul class="list-unstyled medium m-0">
              <% @male_responses.each_with_index do |male_response| %>
                <li><%= male_response.present_genre_i18n %></li>
              <% end %>
            </ul>
          </div>
        </div>

        <div class="row no-gutters p-2">
          <div class="col-1">
            <p class="font-weight-bold">女性</p>
          </div>
          <div class="col-1">
            <ul class="list-unstyled medium">
              <li class="text-gold text-right px-1"><i class="fa-sharp fa-solid fa-crown"></i></span></li>
              <li class="text-silver text-right px-1"><i class="fa-sharp fa-solid fa-crown"></i></span></li>
              <li class="text-bronze text-right px-1"><i class="fa-sharp fa-solid fa-crown"></i></span></li>
            </ul>
          </div>
          <div class="col-10">
            <ul class="list-unstyled medium">
              <% @female_responses.each_with_index do |female_response| %>
                <li><%= female_response.present_genre_i18n %></li>
              <% end %>
            </ul>
          </div>
        </div>
        <div class="text-right">
          <%= link_to responses_path, class: "btn bg-blue btn-sm text-white" do %>
          アンケート結果をもっと見る <i class="fa-solid fa-angles-right"></i>
          <% end %>
        </div>
      </div>
    </div>


    <h5 class="headline bg-beige font-weight-bold py-3 mt-5">
      楽天プレゼントランキング
      <%= link_to  items_path, class: "text-dark font-weight-bold small float-right pr-3" do %>
        もっと見る <i class="fa-solid fa-angles-right"></i>
      <% end %>
    </h5>
    <div class="card-deck pt-3 px-3">
      <% @items.each_with_index do |item, i| %>
      <div class="card position-relative m-2">
        <%= content_tag :div, class: "card-rank position-absolute rounded-circle #{@rank_colors[i]} text-white my-n3 mx-n2", style: "width: 40px;height: 40px;" do %>
          <h6 class="text-center", style="line-height: 40px;"><%= i + 1 %></h6>
        <% end %>
        <%= link_to item_path(item.code, name: item.name, code: item.code, genre: item.genre.id, price: item.price, image: item.medium_image_urls[0], url: item.url) do %>
          <%= image_tag (item['mediumImageUrls'][0]), class:"card-img-top" %>
        <% end %>
        <div class="card-body p-2">
          <h6 class="card-title text-limit mb-1"><%= item.name %></h5>
          <p class="card-text text-truncate medium"><%= number_with_delimiter(item.price) %>円</p>
        </div>
      </div>
      <% end %>
    </div>

   <h5 class="headline bg-beige font-weight-bold py-3 mt-5">
      GiveLikeレビューランキング
      <%= link_to reviews_ranking_path, class: "text-dark font-weight-bold small float-right pr-3" do %>
        もっと見る <i class="fa-solid fa-angles-right"></i>
      <% end %>
    </h5>
    <div class="card-deck pt-3 px-3 mb-5">
      <% @reviews.each_with_index do |review, i| %>
      <div class="card position-relative m-2">
        <%= content_tag :div, class: "card-rank position-absolute rounded-circle #{@rank_colors[i]} text-white my-n3 mx-n2", style: "width: 40px;height: 40px;" do %>
          <h6 class="text-center", style="line-height: 40px;"><%= i + 1 %></h6>
        <% end %>
        <%= link_to item_path(review.code, name: review.name, code: review.code, price: review.price, image: review.image, url: review.url) do %>
          <%= image_tag (review.image), class:"card-img-top" %>
        <% end %>
        <div class="card-body p-2">
          <h6 class="card-title text-limit mb-1"><%= review.name %></h5>
          <div class="card-rate row">
            <div class="col-auto pr-1">
              <div id="star-rate<%= review.id %>"></div>
              <script>
                $('#star-rate<%= review.id %>').empty();
                var elem = document.getElementById('star-rate<%= review.id %>');
                var opt = {
                  starOn: "<%= asset_path('star-on-sm.png') %>",
                  starOff: "<%= asset_path('star-off-sm.png') %>",
                  starHalf: "<%= asset_path('star-half-sm.png') %>",
                  half: true,
                  readOnly: true,
                  size : 12,
                  score: <%= (Review.where(code: review.code).sum  {|review| review.evaluation} / Review.where(code: review.code).length).round(1) %>,
                  };
                raty(elem,opt);
              </script>
            </div>
            <p class="col-2 medium text-secondary py-1 px-0 m-0">(<%= Review.where(code: review.code).count %>)</p>
          </div>
          <p class="card-text text-truncate medium"><%= number_with_delimiter(review.price) %>円</p>
        </div>
      </div>
      <% end %>
    </div>

  </div>
</div>